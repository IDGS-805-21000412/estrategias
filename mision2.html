<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agencia Secreta de Libros - Misi√≥n 2</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Fredoka+One&display=swap" rel="stylesheet">
    
</head>
<body>
    <div class="container">
        <section id="mission2">
            <div class="mission">
                <h2>MISI√ìN 2: "Operaci√≥n Pulsera Dorada"</h2>
                <p><span style="color: green;"><strong>Nivel:</strong> Intermedio</span></p>

                <div class="mission-text">
                    <p><strong>Instrucciones para el agente lector:</strong></p>
                    <p>Leer la historia <em>"La pulsera"</em> y resolver los desaf√≠os ocultos para descubrir el verdadero valor de las cosas.</p>
                    
                    <a href="pdf/LA PULSERA.pdf" target="_blank" class="pdf-btn">üìñ Leer "La pulsera"</a>
                    
                    <!-- Reto 1 -->
                    <h3>Reto 1: Memoria secreta</h3>
                    <p>Ordena los siguientes eventos en la secuencia correcta arrastrando las tarjetas a los espacios en blanco:</p>

                    <div class="sequence-cards" id="originalCards">
                        <div class="event-card" draggable="true" data-order="1">La ni√±a observa durante d√≠as la pulsera en el escaparate.</div>
                        <div class="event-card" draggable="true" data-order="2">La ni√±a entra a la joyer√≠a.</div>
                        <div class="event-card" draggable="true" data-order="3">El joyero envuelve la pulsera para regalo.</div>
                        <div class="event-card" draggable="true" data-order="4">La ni√±a entrega todo lo que tiene para pagarla.</div>
                        <div class="event-card" draggable="true" data-order="5">La madre regresa con la pulsera al d√≠a siguiente.</div>
                    </div>

                    <h3>Ordena las tarjetas aqu√≠:</h3>
                    <div class="sequence-slots" id="dropSlots">
                        <div class="sequence-slot" data-slot="1"></div>
                        <div class="sequence-slot" data-slot="2"></div>
                        <div class="sequence-slot" data-slot="3"></div>
                        <div class="sequence-slot" data-slot="4"></div>
                        <div class="sequence-slot" data-slot="5"></div>
                    </div>

                    <button class="btn" id="checkSequence">Verificar secuencia</button>
                    <div class="sequence-feedback" id="feedback"></div>

                    <!-- Reto 2 -->
                    <h3>Reto 2: Acertijo del Valor</h3>
                    <p>Desbloquea el c√≥digo secreto respondiendo este enigma:</p>
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 10px; margin: 20px 0; border-left: 5px solid #3366cc;">
                        <p><em>"No brilla como el oro, pero vale mucho m√°s.<br>
                        No se guarda en una caja, pero s√≠ en el coraz√≥n.<br><br>
                        ¬øQu√© es? (Pista: No todo lo valioso se puede comprar)"</em></p>
                    </div>

                    <p>Selecciona la respuesta correcta:</p>
                    <div class="flip-card-container">
                        <div class="flip-card" data-answer="false">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">A) Un anillo</div>
                                <div class="flip-card-back incorrect">‚úñ</div>
                            </div>
                        </div>
                        <div class="flip-card" data-answer="false">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">B) El dinero</div>
                                <div class="flip-card-back incorrect">‚úñ</div>
                            </div>
                        </div>
                        <div class="flip-card" data-answer="true">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">C) El amor</div>
                                <div class="flip-card-back">‚úì</div>
                            </div>
                        </div>
                        <div class="flip-card" data-answer="false">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">D) Un regalo costoso</div>
                                <div class="flip-card-back incorrect">‚úñ</div>
                            </div>
                        </div>
                    </div>
                    <div class="sequence-feedback" id="feedback2"></div>

                    <!-- Reto 3 -->
                    <h3>Reto 3: Mensaje encriptado</h3>
                    <p>Rearma la siguiente frase con las palabras en desorden:</p>
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 10px; margin: 20px 0; border-left: 5px solid #3366cc;">
                        <p><em>que / valor / dio / m√°s / su / todo / hija / ten√≠a / que / lo / el</em></p>
                        <p style="font-size: 0.9rem; color: #666;">(Respuesta correcta: "Su hija dio todo lo que ten√≠a, m√°s que el valor")</p>
                    </div>

                    <div class="word-puzzle">
                        <div class="word-bank" id="wordBank">
                            <div class="word-piece" draggable="true">que</div>
                            <div class="word-piece" draggable="true">valor</div>
                            <div class="word-piece" draggable="true">dio</div>
                            <div class="word-piece" draggable="true">m√°s</div>
                            <div class="word-piece" draggable="true">su</div>
                            <div class="word-piece" draggable="true">todo</div>
                            <div class="word-piece" draggable="true">hija</div>
                            <div class="word-piece" draggable="true">ten√≠a</div>
                            <div class="word-piece" draggable="true">que</div>
                            <div class="word-piece" draggable="true">lo</div>
                            <div class="word-piece" draggable="true">el</div>
                        </div>

                        <p>Ordena las palabras aqu√≠:</p>
                        <div class="word-slots" id="wordSlots">
                            <div class="word-slot" data-slot="1"></div>
                            <div class="word-slot" data-slot="2"></div>
                            <div class="word-slot" data-slot="3"></div>
                            <div class="word-slot" data-slot="4"></div>
                            <div class="word-slot" data-slot="5"></div>
                            <div class="word-slot" data-slot="6"></div>
                            <div class="word-slot" data-slot="7"></div>
                            <div class="word-slot" data-slot="8"></div>
                            <div class="word-slot" data-slot="9"></div>
                            <div class="word-slot" data-slot="10"></div>
                            <div class="word-slot" data-slot="11"></div>
                        </div>

                        <button class="btn" id="checkWords">Verificar frase</button>
                        <div class="sequence-feedback" id="feedback3"></div>
                    </div>
                </div>
            </div>
            
            <div class="mission-button-container">
                <a href="mision3.html">
                    <button class="btn" id="nextMissionBtn" disabled>Ir a la Misi√≥n 3</button>
                </a>
            </div>
        </section>
    </div>

    <div class="reward-alert" id="rewardAlert">
        <div class="reward-content">
            <h2 class="reward-title">¬°Felicidades, has ganado!</h2>
            <p class="reward-subtitle">Recompensa de agente:</p>
            <img src="img/recompensa2.png" alt="Personaje desbloqueado" class="reward-character">
            <button class="reward-btn" id="closeReward">¬°Aceptar recompensa!</button>
        </div>
    </div>

    <div class="confetti-container" id="confettiContainer"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variables globales
            const rewardAlert = document.getElementById('rewardAlert');
            const closeRewardBtn = document.getElementById('closeReward');
            const nextMissionBtn = document.getElementById('nextMissionBtn');
            const confettiContainer = document.getElementById('confettiContainer');
            
            let challengesCompleted = 0;
            const totalChallenges = 3;

            // Funci√≥n para lanzar confeti
            function launchConfetti() {
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    confettiContainer.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 5000);
                }
            }

            // Funci√≥n para completar un reto
            function completeChallenge() {
                challengesCompleted++;
                if (challengesCompleted === totalChallenges) {
                    rewardAlert.classList.add('show');
                    launchConfetti();
                    nextMissionBtn.disabled = false;
                }
            }

            // Cerrar la alerta de recompensa
            closeRewardBtn.addEventListener('click', function() {
                rewardAlert.classList.remove('show');
            });

            // Reto 1: Ordenar secuencia
            const originalCards = document.getElementById('originalCards');
            const dropSlots = document.getElementById('dropSlots');
            const checkSequenceBtn = document.getElementById('checkSequence');
            const feedback = document.getElementById('feedback');
            
            let draggedCard = null;

            document.querySelectorAll('.event-card').forEach(card => {
                card.addEventListener('dragstart', function() {
                    draggedCard = this;
                    setTimeout(() => {
                        this.classList.add('dragging');
                    }, 0);
                });

                card.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                });
            });

            document.querySelectorAll('.sequence-slot').forEach(slot => {
                slot.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('highlight');
                });

                slot.addEventListener('dragleave', function() {
                    this.classList.remove('highlight');
                });

                slot.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('highlight');
                    
                    if (this.firstChild) {
                        originalCards.appendChild(this.firstChild);
                    }
                    
                    if (draggedCard) {
                        this.appendChild(draggedCard);
                    }
                });
            });

            checkSequenceBtn.addEventListener('click', function() {
                let isCorrect = true;
                const slots = document.querySelectorAll('.sequence-slot');
                
                slots.forEach((slot, index) => {
                    const card = slot.querySelector('.event-card');
                    if (!card || card.dataset.order != (index + 1)) {
                        isCorrect = false;
                    }
                });
                
                if (isCorrect) {
                    feedback.textContent = '¬°Secuencia correcta! Has completado el reto.';
                    feedback.className = 'sequence-feedback correct';
                    completeChallenge();
                } else {
                    feedback.textContent = 'La secuencia no es correcta. Int√©ntalo de nuevo.';
                    feedback.className = 'sequence-feedback incorrect';
                }
            });

            // Reto 2: Tarjetas volteables
            const feedback2 = document.getElementById('feedback2');
            const flipCards = document.querySelectorAll('.flip-card');

            flipCards.forEach(card => {
                card.addEventListener('click', function() {
                    if (this.classList.contains('flipped')) return;
                    
                    this.classList.add('flipped');
                    const isCorrect = this.dataset.answer === "true";
                    
                    if (isCorrect) {
                        feedback2.textContent = '¬°Correcto! El amor es m√°s valioso que cualquier objeto material.';
                        feedback2.className = 'sequence-feedback correct';
                        completeChallenge();
                    } else {
                        feedback2.textContent = 'Incorrecto. Intenta con otra opci√≥n.';
                        feedback2.className = 'sequence-feedback incorrect';
                    }
                });
            });

            // Reto 3: Ordenar palabras
            const wordBank = document.getElementById('wordBank');
            const wordSlots = document.getElementById('wordSlots');
            const checkWordsBtn = document.getElementById('checkWords');
            const feedback3 = document.getElementById('feedback3');
            
            const correctOrder = ["su", "hija", "dio", "todo", "lo", "que", "ten√≠a", ",", "m√°s", "que", "el", "valor"];
            let draggedWord = null;

            document.querySelectorAll('.word-piece').forEach(word => {
                word.addEventListener('dragstart', function() {
                    draggedWord = this;
                    setTimeout(() => {
                        this.classList.add('dragging');
                    }, 0);
                });

                word.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                });
            });

            document.querySelectorAll('.word-slot').forEach(slot => {
                slot.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('highlight');
                });

                slot.addEventListener('dragleave', function() {
                    this.classList.remove('highlight');
                });

                slot.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('highlight');
                    
                    if (this.firstChild) {
                        wordBank.appendChild(this.firstChild);
                    }
                    
                    if (draggedWord) {
                        this.appendChild(draggedWord);
                    }
                });
            });

            checkWordsBtn.addEventListener('click', function() {
                let isCorrect = true;
                const slots = document.querySelectorAll('.word-slot');
                
                slots.forEach((slot, index) => {
                    const word = slot.querySelector('.word-piece');
                    if (!word || word.textContent.toLowerCase() !== correctOrder[index]) {
                        isCorrect = false;
                    }
                });
                
                if (isCorrect) {
                    feedback3.textContent = '¬°Frase correcta! Has completado el reto.';
                    feedback3.className = 'sequence-feedback correct';
                    completeChallenge();
                } else {
                    feedback3.textContent = 'La frase no es correcta. Int√©ntalo de nuevo.';
                    feedback3.className = 'sequence-feedback incorrect';
                }
            });
        });
    </script>
</body>
</html>